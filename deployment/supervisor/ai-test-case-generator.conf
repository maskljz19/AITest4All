# Supervisor configuration for AI Test Case Generator
# Place this file in /etc/supervisor/conf.d/

[program:ai-test-case-generator]
command=/var/www/ai-test-case-generator/backend/venv/bin/uvicorn app.main:app --host 0.0.0.0 --port 8000 --workers 4
directory=/var/www/ai-test-case-generator/backend
user=www-data
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/supervisor/ai-test-case-generator.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile=/var/log/supervisor/ai-test-case-generator-error.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=10
environment=PATH="/var/www/ai-test-case-generator/backend/venv/bin"
stopwaitsecs=60
stopsignal=TERM
killasgroup=true
stopasgroup=true

[program:ai-test-case-celery]
command=/var/www/ai-test-case-generator/backend/venv/bin/celery -A app.celery worker --loglevel=info --concurrency=4
directory=/var/www/ai-test-case-generator/backend
user=www-data
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/supervisor/ai-test-case-celery.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10
environment=PATH="/var/www/ai-test-case-generator/backend/venv/bin"
stopwaitsecs=60
stopsignal=TERM
killasgroup=true
stopasgroup=true
priority=999

[group:ai-test-case]
programs=ai-test-case-generator,ai-test-case-celery
priority=999
